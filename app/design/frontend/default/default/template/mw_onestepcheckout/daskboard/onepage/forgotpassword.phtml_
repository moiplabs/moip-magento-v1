<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2009 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php if(version_compare(Mage::getVersion(),'1.4.0.1','>='))://fix cho magento 1.3?>
			<div class="page-title" style="margin:0px 0px 10px;border:0px;overflow:hidden;width:100%;">
				<h1 style="color:#0A263C;font-size:20px;margin:0;font-weight:normal;line-height:1.35;"><?php echo $this->__('Forgot Your Password?') ?></h1>
			</div>
			<?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
			<form method="post" id="form-validate" style="display:inline;">
				<div class="fieldset" style="padding:15px 0px 0px; margin:0px;background:none repeat scroll 0 0 #FBFAF6;border:1px solid #BBAFA0;">
					<h2 class="legend" style="margin:-25px 0 0 25px;background:none repeat scroll 0 0 #F9F3E3;border:1px solid #F19900;color:#E76200;float:left;font-size:13px;font-weight:bold;padding:0 8px;line-height:1.35;"><?php echo $this->__('Retrieve your password here')?></h2>
					<p style="margin-left: 0.8em;text-align:left;margin:0 0 10px;padding-left:15px;"><?php echo $this->__('Please enter your email below and we\'ll send you a new password.')?></p>
					<ul class="form-list" style="list-style:none outside none;">
						<li  style="margin:0 0 8px;">
							<label for="email_address" class="required" style="margin-left: 0.8em;width:100px;color:#666666;float:left;font-weight:bold;z-index:0;"><?php echo $this->__('Email Address');?><em style="position:static;float:none;color:#EB340A;font-style:normal;right:-8px;top:0;">*</em></label>
							<div class="input-box" style="float:left;text-align:left;display:block;width:260px;">
								<input type="text" style="width: 200px !important;padding:2px;background:none repeat scroll 0 0 #FFFFFF;border:1px solid #B6B6B6;color:#2F2F2F;font:12px/15px Arial,Helvetica,sans-serif;vertical-align:middle;" name="email" alt="email" id="email_address" class="input-text required-entry validate-email" value="<?php echo $this->htmlEscape($this->getEmailValue()) ?>" />
								<div style="display: none;background:url('../images/validation_advice_bg.gif') no-repeat scroll 2px 0 transparent;clear:both;color:#EB340A;font-size:11px;font-weight:bold;line-height:13px;margin:3px 0 0;min-height:13px;padding-left:17px;" id="errorforgotpass" class="validation-advice"><?php echo $this->__('Invalid email!');?></div>
							</div>
						</li>
					</ul>
				</div>
				<div class="buttons-set" style="margin:0px;border-top:1px solid #E4E4E4;clear:both;padding:8px 0 0;text-align:right;">
					<p class="required" style="margin:0px;color:#EB340A;font-size:11px;text-align:right;"><?php echo $this->__('* Required Fields') ?></p>
					<p class="back-link" style="float:left;margin:0;"><a id="backlogin" href="#inline1" style="color:#1E7EC8;text-decoration:underline;"<?php /*href="<?php echo $this->helper('customer')->getLoginUrl() ?>"*/?> ><small style="font-size:1em;">&laquo; </small><?php echo $this->__('Back to Login') ?></a></p>
					<span style="display: none;float:right;" id="forgotpass-please-wait" class="please-wait">
						<img class="v-middle" style="vertical-align:middle;border:0 none;" title="Loading next step..." alt="Loading next step..." src="<?php echo $this->getSkinUrl('/mw_onestepcheckout/images/opc-ajax-loader.gif') ?>"><?php echo $this->__('Loading...');?>       
					</span>
					<button id="btforgotpass" style="float:right;margin-left:5px;background:none repeat scroll 0 0 transparent;border:0 none;cursor:pointer;margin:0;overflow:visible;padding:0;width:auto;color:#2F2F2F;font:12px/15px Arial,Helvetica,sans-serif;vertical-align:middle;" type="button" onclick="onepageforgotpassword(this)" title="<?php echo $this->__('Submit') ?>" class="button"><span style="background:none repeat scroll 0 0 #F18200;border:1px solid #DE5400;color:#FFFFFF;display:block;font:bold 12px/19px Arial,Helvetica,sans-serif;height:19px;padding:0 8px;text-align:center;white-space:nowrap;"><span style="border:0 none;padding:0;background:none repeat scroll 0 0 #F18200;color:#FFFFFF;display:block;font:bold 12px/19px Arial,Helvetica,sans-serif;height:19px;text-align:center;white-space:nowrap;"><?php echo $this->__('Submit') ?></span></span></button>
				</div>
			</form>
<?php else: //fix cho IE?>	
			<div class="page-title" style="margin:0px 0px 10px;border:0px;overflow:hidden;width:100%;">
				<h1 style="color:#0A263C;font-size:20px;margin:0;font-weight:normal;line-height:1.35;"><?php echo $this->__('Forgot Your Password?') ?></h1>
			</div>
			<?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
			<form method="post" id="form-validate" style="display:inline;">
				<div class="fieldset" style="padding:15px 0px 0px; margin:0px;background:none repeat scroll 0 0 #FBFAF6;border:1px solid #BBAFA0;">
					<h2 class="legend" style="margin:-25px 0 0 25px;background:none repeat scroll 0 0 #F9F3E3;border:1px solid #F19900;color:#E76200;float:left;font-size:13px;font-weight:bold;padding:0 8px;line-height:1.35;"><?php echo $this->__('Retrieve your password here') ?></h2>
					<p style="margin-left: 0.8em;text-align:left;margin:0 0 10px;padding-left:15px;"><?php echo $this->__('Please enter your email below and we\'ll send you a new password.') ?></p>
					<ul class="form-list" style="list-style:none outside none;">
						<li style="margin:0 0 8px;">
							<label for="email_address" class="required" style="margin-left: 0.8em;width:100px;color:#666666;float:left;font-weight:bold;z-index:0;"><?php echo $this->__('Email Address') ?><em style="position:static;float:none;color:#EB340A;font-style:normal;right:-8px;top:0;">*</em></label>
							<div class="input-box" style="clear:none;text-align:left;display:block;width:260px;">
								<input type="text" style="width: 200px !important;padding:2px;background:none repeat scroll 0 0 #FFFFFF;border:1px solid #B6B6B6;color:#2F2F2F;font:12px/15px Arial,Helvetica,sans-serif;vertical-align:middle;" name="email" alt="email" id="email_address" class="input-text required-entry validate-email" value="<?php echo $this->htmlEscape($this->getEmailValue()) ?>" />
								<div style="display: none;background:url('../images/validation_advice_bg.gif') no-repeat scroll 2px 0 transparent;clear:both;color:#EB340A;font-size:11px;font-weight:bold;line-height:13px;margin:3px 0 0;min-height:13px;padding-left:17px;" id="errorforgotpass" class="validation-advice"><?php echo $this->__('Invalid email!');?></div>
								</div>
						</li>
					</ul>
				</div>
				<div class="buttons-set" style="margin:0px;border-top:1px solid #E4E4E4;clear:both;padding:8px 0 0;text-align:right;">
					<p class="required" style="margin:0px;color:#EB340A;font-size:11px;text-align:right;"><?php echo $this->__('* Required Fields') ?></p>
					<p class="back-link" style="float:left;margin:0;"><a id="backlogin" href="#inline1" style="color:#1E7EC8;text-decoration:underline;"<?php /*href="<?php echo $this->helper('customer')->getLoginUrl() ?>"*/?> ><small style="font-size:1em;">&laquo; </small><?php echo $this->__('Back to Login') ?></a></p>
					<span style="display: none;float:right;" id="forgotpass-please-wait" class="please-wait">
						<img class="v-middle" style="vertical-align:middle;border:0 none;"title="Loading next step..." alt="Loading next step..." src="<?php echo $this->getSkinUrl('/mw_onestepcheckout/images/opc-ajax-loader.gif') ?>"><?php echo $this->__('Loading...');?>        
					</span>
					<button id="btforgotpass" style="float:right;margin-left:5px;background:none repeat scroll 0 0 transparent;border:0 none;cursor:pointer;margin:0;overflow:visible;padding:0;width:auto;color:#2F2F2F;font:12px/15px Arial,Helvetica,sans-serif;vertical-align:middle;"type="button" onclick="onepageforgotpassword(this)" title="<?php echo $this->__('Submit') ?>" class="button"><span style="background:none repeat scroll 0 0 #F18200;border:1px solid #DE5400;color:#FFFFFF;display:block;font:bold 12px/19px Arial,Helvetica,sans-serif;height:19px;padding:0 8px;text-align:center;white-space:nowrap;"><span style="border:0 none;padding:0;background:none repeat scroll 0 0 #F18200;color:#FFFFFF;display:block;font:bold 12px/19px Arial,Helvetica,sans-serif;height:19px;text-align:center;white-space:nowrap;"><?php echo $this->__('Submit') ?></span></span></button>
				</div>
			</form>
<?php endif?>
<script type="text/javascript">
//<![CDATA[
    var dataForm = new VarienForm('form-validate', true);
    function onepageforgotpassword(button)
    {
        if(dataForm.validator && dataForm.validator.validate()){
            //button.disabled = true;
           // loginForm.submit();
		   updateForgotpassword($MW_Onestepcheckout('#email_address').val());
        }
		$MW_Onestepcheckout('#errorforgotpass').css('display','none');
		//$MW_Onestepcheckout('#email_address').addClass('validation-failed')
    }
//]]>
</script>
<script type="text/javascript">
function updateForgotpassword(email)
{
$MW_Onestepcheckout('#btforgotpass').css('display','none');
$MW_Onestepcheckout('#forgotpass-please-wait').css('display','block');	//note: echo $this->getChildHtml('login_before') cuar .col2-set
	$MW_Onestepcheckout.ajax({
	type: "POST",
	url: "<?php echo Mage::getUrl('onestepcheckout/index/forgotpass')?>",
	data: "email="+email,
	success: function(msg){
			if(msg==1){
				$MW_Onestepcheckout('#inline3').html("<div style='text-align:left;'><h1><?php echo $this->__('Forgotten your password?')?></h1><?php echo $this->__("Enter your email below and we'll send you a new password by email.")?><br><?php echo $this->__("We have now sent you a new password to your email address. Click the link below to return to login.");?><br><p class='back-link'><a id='backlogin1' href='#inline1'><small>&laquo; </small><?php echo $this->__('Back to Login')?></a></p></div>");
				$MW_Onestepcheckout("#backlogin1").fancybox({
					'titlePosition'		: 'inside',
					'transitionIn'		: 'none',
					'transitionOut'		: 'none'
				});
			}
			else{
				$MW_Onestepcheckout('#btforgotpass').css('display','block');
				$MW_Onestepcheckout('#forgotpass-please-wait').css('display','none');
				$MW_Onestepcheckout('#errorforgotpass').css('display','block');	
				$MW_Onestepcheckout('#email_address').addClass('validation-failed')
				}
		}
	});
}
</script>

